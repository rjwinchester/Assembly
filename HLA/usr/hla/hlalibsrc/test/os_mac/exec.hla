program exec_test;
#include( "stdlib.hhf" )
#include( "mac.hhf" )

static
	rtnCode	:dword;
	env0	:dword[2] := [0,0];
	cmds	:string[2] :=
			[
				"./exec",
				"1"
			];

begin exec_test;

	// From the makefile, this program is run with no arguments:
	
	if( arg.c() = 0 ) then
	
		mac.fork();
		if( eax = 0 ) then
		
			mac.execve( cmds[0], cmds[0], env0 );
			stdout.put( "Error, did not execve properly" nl );
			os.exitProcess( 1 );
			
		endif;
		
		// Wait for the child process to complete
			
		mac.waitpid( eax, rtnCode, 0 );
		stdout.put( "Exec succeeded!" nl );
		os.exitProcess( rtnCode );
		
	endif;
	
	// From above, this program is run with an argument:
	
	stdout.put( "Child process run from mac.execve" nl );
	os.exitProcess( 0 );
	
end exec_test;

													