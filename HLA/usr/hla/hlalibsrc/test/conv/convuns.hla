program convuns_test;
#include( "stdlib.hhf" )

static
	Handle			:dword;
	inputL			:lword;
	input			:str.strvar(256);
	IllegalCharStr	:string := #$80;
	
	procedure cmp128( left:lword; right:lword ); @returns( "@ne" );
	begin cmp128;
	
		cld();
		lea( esi, left );
		lea( edi, right );
		mov( 4, ecx );
		repe.cmpsd();
		
	end cmp128;
	
	
begin convuns_test;

	// Testing conv.atou8

	try
	
		lea( esi, "8" );
		conv.atou8( [esi] );
		if( eax <> 8 ) then
		
			raise($1080);
		
		endif;	
		
		lea( esi, " 128 " );
		conv.atou8( [esi] );
		if( eax <> 128 ) then
		
			raise($1081);
		
		endif;	
		
		lea( esi, "0  " );
		conv.atou8( [esi] );
		if( eax <> $0 ) then
		
			raise($1082);
		
		endif;	
		
		lea( esi, "127" );
		conv.atou8( [esi] );
		if( eax <> $7f ) then
		
			raise($1083);
		
		endif;
		
		lea( esi, "255" );
		conv.atou8( [esi] );
		if( eax <> 255 ) then
		
			raise($1084);
		
		endif;
		
		try
		
			lea( esi, "256" );
			conv.atou8( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1085 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			mov( IllegalCharStr, esi );
			conv.atou8( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1086 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.atou8 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.atou8 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;




	try
	
		conv.strTou8( "8", 0 );
		if( eax <> 8 ) then
		
			raise($1_1080);
		
		endif;	
		
		conv.strTou8( " 128 ", 0 );
		if( eax <> 128 ) then
		
			raise($1_1081);
		
		endif;	
		
		conv.strTou8( "0    ", 0 );
		if( eax <> $0 ) then
		
			raise($1_1082);
		
		endif;	
		
		conv.strTou8( " 127 ", 1 );
		if( eax <> $7f ) then
		
			raise($1_1083);
		
		endif;
		
		conv.strTou8( "255", 0 );
		if( eax <> 255 ) then
		
			raise($1_1084);
		
		endif;
		
		try
		
			conv.strTou8( "256", 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1_1085 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			conv.strTou8( IllegalCharStr, 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1_1086 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		

		try
		
			conv.strTou8( "", 10 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// index exception.
			
		  	Raise( $1_1327 );
			
		  exception( ex.StringIndexError )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;


		stderr.put( "conv.strTou8 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.strTou8 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;



	//////////////////////////////////////////////////////////////////////////
	//
	// Testing conv.atou16

	try
	
		lea( esi, "16" );
		conv.atou16( [esi] );
		if( eax <> 16 ) then
		
			raise($1160);
		
		endif;	
		
		lea( esi, " 256 " );
		conv.atou16( [esi] );
		if( eax <> 256 ) then
		
			raise($1161);
		
		endif;	
		
		lea( esi, "0  " );
		conv.atou16( [esi] );
		if( eax <> $0 ) then
		
			raise($1162);
		
		endif;	
		
		lea( esi, "32768" );
		conv.atou16( [esi] );
		if( eax <> $8000 ) then
		
			raise($1163);
		
		endif;
		
		lea( esi, "65535" );
		conv.atou16( [esi] );
		if( eax <> 65535 ) then
		
			raise($1164);
		
		endif;
		
		try
		
			lea( esi, "65536" );
			conv.atou16( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1165 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			mov( IllegalCharStr, esi );
			conv.atou16( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1166 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.atou16 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.atou16 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;




	try
	
		conv.strTou16( "16", 0 );
		if( eax <> 16 ) then
		
			raise($1_1160);
		
		endif;	
		
		conv.strTou16( " 256 ", 0 );
		if( eax <> 256 ) then
		
			raise($1_1161);
		
		endif;	
		
		conv.strTou16( "0 ", 0 );
		if( eax <> $0 ) then
		
			raise($1_1162);
		
		endif;	
		
		conv.strTou16( "32768", 0 );
		if( eax <> $8000 ) then
		
			raise($1_1163);
		
		endif;
		
		conv.strTou16( " 65535 ", 0 );
		if( eax <> 65535 ) then
		
			raise($1_1164);
		
		endif;
		
		try
		
			conv.strTou16( " 65536 ", 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1_1165 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			conv.strTou16( IllegalCharStr, 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1_1166 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		

		try
		
			conv.strTou16( "", 10 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// index exception.
			
		  	Raise( $1_1167 );
			
		  exception( ex.StringIndexError )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.strTou16 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.strTou16 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;



	//////////////////////////////////////////////////////////////////////////
	//
	// Testing conv.atou32

	try
	
		lea( esi, "32" );
		conv.atou32( [esi] );
		if( eax <> 32 ) then
		
			raise($1320);
		
		endif;	
		
		lea( esi, " 65536 " );
		conv.atou32( [esi] );
		if( eax <> 65536 ) then
		
			raise($1321);
		
		endif;	
		
		lea( esi, "0  " );
		conv.atou32( [esi] );
		if( eax <> $0 ) then
		
			raise($1322);
		
		endif;	
		
		lea( esi, "4294967295" );
		conv.atou32( [esi] );
		if( eax <> $ffff_ffff ) then
		
			raise($1323);
		
		endif;
		
		lea( esi, "2147483648" );
		conv.atou32( [esi] );
		if( eax <> 2147483648 ) then
		
			raise($1324);
		
		endif;
		
		try
		
			lea( esi, "4294967296" );
			conv.atou32( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1325 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			mov( IllegalCharStr, esi );
			conv.atou32( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1326 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.atou32 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.atou32 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;





	try
	
		conv.strTou32( "32", 0 );
		if( eax <> 32 ) then
		
			raise($1_1320);
		
		endif;	
		
		conv.strTou32( " 65536 ", 0 );
		if( eax <> 65536 ) then
		
			raise($1_1321);
		
		endif;	
		
		conv.strTou32( "0 ", 0 );
		if( eax <> $0 ) then
		
			raise($1_1322);
		
		endif;	
		
		conv.strTou32( "4294967295", 0 );
		if( eax <> $ffff_ffff ) then
		
			raise($1_1323);
		
		endif;
		
		conv.strTou32( " 2147483648", 1 );
		if( eax <> 2147483648 ) then
		
			raise($1_1324);
		
		endif;
		
		try
		
			conv.strTou32( "4294967296", 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1_1325 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			conv.strTou32( IllegalCharStr, 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1_1326 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		

		try
		
			conv.strTou32( "", 10 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// index exception.
			
		  	Raise( $1_1327 );
			
		  exception( ex.StringIndexError )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.strTou32 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.strTou32 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;




	//////////////////////////////////////////////////////////////////////////
	//
	// Testing conv.atou64

	try
	
		lea( esi, "64" );
		conv.atou64( [esi] );
		if( eax <> 64 || edx <> 0 ) then
		
			raise($1640);
		
		endif;	
		
		lea( esi, " 4294967296 " );
		conv.atou64( [esi] );
		if( eax <> 0 || edx <> 1 ) then
				
			raise($1641);
		
		endif;	
		
		lea( esi, "0  " );
		conv.atou64( [esi] );
		if( eax <> $0 || edx <> 0 ) then
		
			raise($1642);
		
		endif;	
		
		lea( esi, "9223372036854775808" );
		conv.atou64( [esi] );
		if( eax <> $0 || edx <> $8000_0000 ) then
		
			raise($1643);
		
		endif;
		
		lea( esi, "18446744073709551615" );
		conv.atou64( [esi] );
		if( eax <> $ffff_ffff || edx <> $ffff_ffff ) then
		
			raise($1644);
		
		endif;
		
		try
		
			lea( esi, "18446744073709551616" );
			conv.atou64( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1645 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			mov( IllegalCharStr, esi );
			conv.atou64( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1646 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.atou64 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.atou64 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;






	try
	
		conv.strTou64( "64", 0 );
		if( eax <> 64 || edx <> 0 ) then
		
			raise($1_1640);
		
		endif;	
		
		conv.strTou64( " 4294967296 ", 0 );
		if( eax <> 0 || edx <> 1 ) then
				
			raise($1_1641);
		
		endif;	
		
		conv.strTou64( "0 ", 0 );
		if( eax <> $0 || edx <> 0 ) then
		
			raise($1_1642);
		
		endif;	
		
		conv.strTou64( "9223372036854775808", 0 );
		if( eax <> $0 || edx <> $8000_0000 ) then
		
			raise($1_1643);
		
		endif;
		
		conv.strTou64( "18446744073709551615", 0 );
		if( eax <> $ffff_ffff || edx <> $ffff_ffff ) then
		
			raise($1_1644);
		
		endif;
		
		try
		
			conv.strTou64( "18446744073709551616", 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1_1645 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			conv.strTou64( IllegalCharStr, 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1_1646 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		

		try
		
			conv.strTou64( "", 10 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// index exception.
			
		  	Raise( $1_1647 );
			
		  exception( ex.StringIndexError )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;



		stderr.put( "conv.strTou64 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.strTou64 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;





	//////////////////////////////////////////////////////////////////////////
	//
	// Testing conv.atou128

	try
	
		lea( esi, "128" );
		conv.atou128( [esi], inputL );
		if( cmp128( inputL, 128 ) ) then
		
			raise($1280);
		
		endif;	
		
		lea( esi, " 18446744073709551616 " );
		conv.atou128( [esi], inputL );
		if( cmp128( inputL, 18446744073709551616 ) ) then
				
			raise($1281);
		
		endif;	
		
		lea( esi, "0  " );
		conv.atou128( [esi], inputL );
		if( cmp128( inputL, 0 ) ) then
		
			raise($1282);
		
		endif;	
		
		lea( esi, "170141183460469231731687303715884105727" );
		conv.atou128( [esi], inputL );
		if( cmp128( inputL, 170141183460469231731687303715884105727 ) ) then
		
			raise($1283);
		
		endif;
		
		lea( esi, "340282366920938463463374607431768211455" );
		conv.atou128( [esi], inputL );
		if( cmp128( inputL, 340282366920938463463374607431768211455 ) ) then
		
			raise($1284);
		
		endif;
		
		try
		
			lea( esi, "340282366920938463463374607431768211456" );
			conv.atou128( [esi], inputL );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1285 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			mov( IllegalCharStr, esi );
			conv.atou128( [esi], inputL );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1286 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.atou128 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.atou128 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;




	try
	
		conv.strTou128( "128", 0, inputL );
		if( cmp128( inputL, 128 ) ) then
		
			raise($1_1280);
		
		endif;	
		
		conv.strTou128( " 18446744073709551616 ", 0, inputL );
		if( cmp128( inputL, 18446744073709551616 ) ) then
				
			raise($1_1281);
		
		endif;	
		
		conv.strTou128( "0 ", 0, inputL );
		if( cmp128( inputL, 0 ) ) then
		
			raise($1_1282);
		
		endif;	
		
		conv.strTou128( "170141183460469231731687303715884105727", 0, inputL );
		if( cmp128( inputL, 170141183460469231731687303715884105727 ) ) then
		
			raise($1_1283);
		
		endif;
		
		conv.strTou128( "340282366920938463463374607431768211455", 0, inputL );
		if( cmp128( inputL, 340282366920938463463374607431768211455 ) ) then
		
			raise($1_1284);
		
		endif;
		
		try
		
			conv.strTou128( "340282366920938463463374607431768211456", 0, inputL );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1_1285 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			conv.strTou128( IllegalCharStr, 0, inputL );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1_1286 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.strTou128 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.strTou128 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;



end convuns_test;
													