program convint_test;
#include( "stdlib.hhf" )

static
	Handle			:dword;
	inputL			:lword;
	input			:str.strvar(256);
	IllegalCharStr	:string := #$80;
	
	procedure cmp128( left:int128; right:int128 ); @returns( "@ne" );
	begin cmp128;
	
		cld();
		lea( esi, left );
		lea( edi, right );
		mov( 4, ecx );
		repe.cmpsd();
		
	end cmp128;
	
	
begin convint_test;

	// Testing conv.atoi8

	try
	
		lea( esi, "8" );
		conv.atoi8( [esi] );
		if( eax <> 8 ) then
		
			raise($1080);
		
		endif;	
		
		lea( esi, " -8 " );
		conv.atoi8( [esi] );
		if( eax <> -8 ) then
		
			raise($1081);
		
		endif;	
		
		lea( esi, "0  " );
		conv.atoi8( [esi] );
		if( eax <> $0 ) then
		
			raise($1082);
		
		endif;	
		
		lea( esi, "127" );
		conv.atoi8( [esi] );
		if( eax <> $7f ) then
		
			raise($1083);
		
		endif;
		
		lea( esi, "-128" );
		conv.atoi8( [esi] );
		if( eax <> -128 ) then
		
			raise($1084);
		
		endif;
		
		try
		
			lea( esi, "128" );
			conv.atoi8( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1085 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			mov( IllegalCharStr, esi );
			conv.atoi8( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1086 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.atoi8 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.atoi8 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;




	// Testing conv.strToi8

	try
	
		conv.strToi8( "8", 0 );
		if( eax <> 8 ) then
		
			raise($1_1080);
		
		endif;	
		
		conv.strToi8( " -8", 1 );
		if( eax <> -8 ) then
		
			raise($1_1081);
		
		endif;	
		
		conv.strToi8( "0  ", 0 );
		if( eax <> $0 ) then
		
			raise($1_1082);
		
		endif;	
		
		conv.strToi8( "  127 ", 2 );
		if( eax <> $7f ) then
		
			raise($1_1083);
		
		endif;
		
		conv.strToi8( "  -128 ", 2 );
		if( eax <> -128 ) then
		
			raise($1_1084);
		
		endif;
		
		try
		
			conv.strToi8( "128 ", 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1_1085 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			conv.strToi8( IllegalCharStr, 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1_1086 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		

		try
		
			conv.strToi8( "", 10 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// index exception.
			
		  	Raise( $1_1087 );
			
		  exception( ex.StringIndexError )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.strToi8 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.strToi8 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;



	//////////////////////////////////////////////////////////////////////////
	//
	// Testing conv.atoi16

	try
	
		lea( esi, "16" );
		conv.atoi16( [esi] );
		if( eax <> 16 ) then
		
			raise($1160);
		
		endif;	
		
		lea( esi, " -16 " );
		conv.atoi16( [esi] );
		if( eax <> -16 ) then
		
			raise($1161);
		
		endif;	
		
		lea( esi, "0  " );
		conv.atoi16( [esi] );
		if( eax <> $0 ) then
		
			raise($1162);
		
		endif;	
		
		lea( esi, "32767" );
		conv.atoi16( [esi] );
		if( eax <> $7fff ) then
		
			raise($1163);
		
		endif;
		
		lea( esi, "-32768" );
		conv.atoi16( [esi] );
		if( eax <> -32768 ) then
		
			raise($1164);
		
		endif;
		
		try
		
			lea( esi, "32768" );
			conv.atoi16( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1165 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			mov( IllegalCharStr, esi );
			conv.atoi16( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1166 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.atoi16 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.atoi16 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;




	try
	
		conv.strToi16( "16", 0 );
		if( eax <> 16 ) then
		
			raise($1_1160);
		
		endif;	
		
		conv.strToi16( " -16", 0 );
		if( eax <> -16 ) then
		
			raise($1_1161);
		
		endif;	
		
		conv.strToi16( "0", 0 );
		if( eax <> $0 ) then
		
			raise($1_1162);
		
		endif;	
		
		conv.strToi16( "32767", 0 );
		if( eax <> $7fff ) then
		
			raise($1_1163);
		
		endif;
		
		conv.strToi16( "-32768", 0 );
		if( eax <> -32768 ) then
		
			raise($1_1164);
		
		endif;
		
		try
		
		conv.strToi16( "32768", 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1_1165 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			conv.strToi16( IllegalCharStr, 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1_1166 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		

		try
		
			conv.strToi16( "", 10 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// index exception.
			
		  	Raise( $1_1167 );
			
		  exception( ex.StringIndexError )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.strToi16 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.strToi16 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;



	//////////////////////////////////////////////////////////////////////////
	//
	// Testing conv.atoi32

	try
	
		lea( esi, "32" );
		conv.atoi32( [esi] );
		if( eax <> 32 ) then
		
			raise($1320);
		
		endif;	
		
		lea( esi, " -32 " );
		conv.atoi32( [esi] );
		if( eax <> -32 ) then
		
			raise($1321);
		
		endif;	
		
		lea( esi, "0  " );
		conv.atoi32( [esi] );
		if( eax <> $0 ) then
		
			raise($1322);
		
		endif;	
		
		lea( esi, "2147483647" );
		conv.atoi32( [esi] );
		if( eax <> $7fff_ffff ) then
		
			raise($1323);
		
		endif;
		
		lea( esi, "-2147483648" );
		conv.atoi32( [esi] );
		if( eax <> -2147483648 ) then
		
			raise($1324);
		
		endif;
		
		try
		
			lea( esi, "2147483648" );
			conv.atoi32( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1325 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			mov( IllegalCharStr, esi );
			conv.atoi32( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1326 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.atoi32 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.atoi32 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;





	try
	
		conv.strToi32( "32", 0 );
		if( eax <> 32 ) then
		
			raise($1_1320);
		
		endif;	
		
		conv.strToi32( " -32 ", 0 );
		if( eax <> -32 ) then
		
			raise($1_1321);
		
		endif;	
		
		conv.strToi32( "0 ", 0 );
		if( eax <> $0 ) then
		
			raise($1_1322);
		
		endif;	
		
		conv.strToi32( "2147483647", 0 );
		if( eax <> $7fff_ffff ) then
		
			raise($1_1323);
		
		endif;
		
		conv.strToi32( " -2147483648", 1 );
		if( eax <> -2147483648 ) then
		
			raise($1_1324);
		
		endif;
		
		try
		
			conv.strToi32( "2147483648", 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1_1325 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			conv.strToi32( IllegalCharStr, 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1_1326 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		

		try
		
			conv.strToi32( "", 10 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// index exception.
			
		  	Raise( $1_1327 );
			
		  exception( ex.StringIndexError )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.strToi32 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.strToi32 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;




	//////////////////////////////////////////////////////////////////////////
	//
	// Testing conv.atoi64

	try
	
		lea( esi, "64" );
		conv.atoi64( [esi] );
		if( eax <> 64 || edx <> 0 ) then
		
			raise($1640);
		
		endif;	
		
		lea( esi, " 4294967296 " );
		conv.atoi64( [esi] );
		if( eax <> 0 || edx <> 1 ) then
				
			raise($1641);
		
		endif;	
		
		lea( esi, "0  " );
		conv.atoi64( [esi] );
		if( eax <> $0 || edx <> 0 ) then
		
			raise($1642);
		
		endif;	
		
		lea( esi, "-9223372036854775808" );
		conv.atoi64( [esi] );
		if( eax <> $0 || edx <> $8000_0000 ) then
		
			raise($1643);
		
		endif;
		
		lea( esi, "9223372036854775807" );
		conv.atoi64( [esi] );
		if( eax <> $ffff_ffff || edx <> $7fff_ffff ) then
		
			raise($1644);
		
		endif;
		
		try
		
			lea( esi, "9223372036854775808" );
			conv.atoi64( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1645 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			mov( IllegalCharStr, esi );
			conv.atoi64( [esi] );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1646 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.atoi64 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.atoi64 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;






	try
	
		conv.strToi64( "64", 0 );
		if( eax <> 64 || edx <> 0 ) then
		
			raise($1_1640);
		
		endif;	
		
		conv.strToi64( " 4294967296 ", 0 );
		if( eax <> 0 || edx <> 1 ) then
				
			raise($1_1641);
		
		endif;	
		
		conv.strToi64( "0 ", 0 );
		if( eax <> $0 || edx <> 0 ) then
		
			raise($1_1642);
		
		endif;	
		
		conv.strToi64( "-9223372036854775808", 0 );
		if( eax <> $0 || edx <> $8000_0000 ) then
		
			raise($1_1643);
		
		endif;
		
		conv.strToi64( "9223372036854775807", 0 );
		if( eax <> $ffff_ffff || edx <> $7fff_ffff ) then
		
			raise($1_1644);
		
		endif;
		
		try
		
			conv.strToi64( "9223372036854775808", 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1_1645 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			conv.strToi64( IllegalCharStr, 0 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1_1646 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		

		try
		
			conv.strToi64( "", 10 );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// index exception.
			
		  	Raise( $1_1647 );
			
		  exception( ex.StringIndexError )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;



		stderr.put( "conv.strToi64 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.strToi64 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;





	//////////////////////////////////////////////////////////////////////////
	//
	// Testing conv.atoi128

	try
	
		lea( esi, "128" );
		conv.atoi128( [esi], inputL );
		if( cmp128( inputL, 128 ) ) then
		
			raise($1280);
		
		endif;	
		
		lea( esi, " 18446744073709551616 " );
		conv.atoi128( [esi], inputL );
		if( cmp128( inputL, 18446744073709551616 ) ) then
				
			raise($1281);
		
		endif;	
		
		lea( esi, "0  " );
		conv.atoi128( [esi], inputL );
		if( cmp128( inputL, 0 ) ) then
		
			raise($1282);
		
		endif;	
		
		lea( esi, "170141183460469231731687303715884105727" );
		conv.atoi128( [esi], inputL );
		if( cmp128( inputL, 170141183460469231731687303715884105727 ) ) then
		
			raise($1283);
		
		endif;
		
		lea( esi, "-170141183460469231731687303715884105728" );
		conv.atoi128( [esi], inputL );
		if( cmp128( inputL, -170141183460469231731687303715884105728 ) ) then
		
			raise($1284);
		
		endif;
		
		try
		
			lea( esi, "170141183460469231731687303715884105728" );
			conv.atoi128( [esi], inputL );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1285 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			mov( IllegalCharStr, esi );
			conv.atoi128( [esi], inputL );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1286 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.atoi128 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.atoi128 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;




	try
	
		conv.strToi128( "64", 0, inputL );
		if( cmp128( inputL, 64 ) ) then
		
			raise($1_1280);
		
		endif;	
		
		conv.strToi128( "-64", 0, inputL );
		if( cmp128( inputL, -64 ) ) then
				
			raise($1_1281);
		
		endif;	
		
		conv.strToi128( "0", 0, inputL );
		if( cmp128( inputL, 0 ) ) then
		
			raise($1_1282);
		
		endif;	
		
		conv.strToi128( "170141183460469231731687303715884105727", 0, inputL );
		if( cmp128( inputL, 170141183460469231731687303715884105727 ) ) then
		
			raise($1_1283);
		
		endif;
		
		conv.strToi128( "-170141183460469231731687303715884105728", 0, inputL );
		if( cmp128( inputL, -170141183460469231731687303715884105728 ) ) then
		
			raise($1_1284);
		
		endif;
		
		try
		
			conv.strToi128( "170141183460469231731687303715884105728", 0, inputL );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( $1_1285 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;
		
		try
		
			conv.strToi128( IllegalCharStr, 0, inputL );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// character exception.
			
		  	Raise( $1_1286 );
			
		  exception( ex.IllegalChar )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		

		try
		
			conv.strToi128( "", 10, inputL );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an illegal
		  	// index exception.
			
		  	Raise( $1_1287 );
			
		  exception( ex.StringIndexError )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( eax );
			
		endtry;

		stderr.put( "conv.strToi128 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"conv.strToi128 failed! eax=", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;



end convint_test;
													