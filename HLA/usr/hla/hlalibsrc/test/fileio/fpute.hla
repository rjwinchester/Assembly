program fpute_test;
#include( "stdlib.hhf" )

static
	handle	:dword;
	e32		:real32 := 0.0;
	e64		:real64 := 0.0;
	e80		:real80 := 0.0;
	
	e32a	:real32 := 1.0;
	e64a	:real64 := 1.0;
	e80a	:real80 := 1.0;
	
	e32b	:real32 := 1.0e-37;
	e64b	:real64 := 1.0e-307;
	e80b	:real80 := 1.0e-4094;
	
	e32pi	:real32;
	e64pi	:real64;
	e80pi	:real80;

	bad_a	:real64 := 1.0e-272;
	bad_b	:real64 := 1.0e-256;

	
begin fpute_test;


	fileio.openNew( "fpute.txt" );
	mov( eax, handle );


	fileio.puts( handle, "Outputting zeros:" nl nl );
	fileio.pute32( handle, e32, 13 );
	fileio.newln( handle );

	fileio.pute64( handle, e64, 15 );
	fileio.newln( handle );

	fileio.pute80( handle, e80, 20 );
	fileio.newln( handle );
	fileio.newln( handle );
	fileio.newln( handle );

	fileio.puts( handle, "Real32 Powers of Ten: " nl nl );
	for( mov( -37, ecx ); (type int32 ecx) < 0; inc( ecx )) do

		fileio.pute32( handle, e32b, 11 );
		fileio.newln( handle );

		fld( e32b );
		fld( 10.0 );
		fmulp();
		fstp( e32b );

	endfor;
	fld1();
	fstp( e32b );
	for( mov( 0, ecx ); ecx < 38; inc( ecx )) do

		fileio.pute32( handle, e32b, 11 );
		fileio.newln( handle );

		fld( e32b );
		fld( 10.0 );
		fmulp();
		fstp( e32b );

	endfor;
	fileio.newln( handle );
	fileio.newln( handle );
	fileio.newln( handle );


	fileio.puts( handle, "Real64 Powers of Ten: " nl nl );
	for( mov( -307, ecx ); (type int32 ecx) < 0; inc( ecx )) do

		fileio.pute64( handle, e64b, 15 );
		fileio.newln( handle );

		fld( e64b );
		fld( 10.0 );
		fmulp();
		fstp( e64b );

	endfor;
	fld1();
	fstp( e64b );
	for( mov( 0, ecx ); ecx < 308; inc( ecx )) do

		fileio.pute64( handle, e64b, 15 );
		fileio.newln( handle );

		fld( e64b );
		fld( 10.0 );
		fmulp();
		fstp( e64b );

	endfor;
	fileio.newln( handle );
	fileio.newln( handle );
	fileio.newln( handle );


	fileio.puts( handle, "Real80 Powers of Ten: " nl nl );
	for( mov( -4094, ecx ); (type int32 ecx) < 0; inc( ecx )) do

		fileio.pute80( handle, e80b, 18 );
		fileio.newln( handle );

		fld( e80b );
		fld( 10.0 );
		fmulp();
		fstp( e80b );

	endfor;

	fld1();
	fstp( e80b );
	for( mov( 0, ecx ); ecx <= 4095; inc( ecx )) do

		fileio.pute80( handle, e80b, 18 );
		fileio.newln( handle );

		fld( e80b );
		fld( 10.0 );
		fmulp();
		fstp( e80b );

	endfor;
	fileio.newln( handle );
	fileio.newln( handle );
	fileio.newln( handle );


	fileio.puts( handle, "Real32 Powers of Two: " nl nl );
	for( mov( 0, ecx ); ecx < 127; inc( ecx )) do

		fileio.pute32( handle, e32a, 11 );
		fileio.newln( handle );

		fld( e32a );
		fld( 2.0 );
		fmulp();
		fstp( e32a );

	endfor;
	fileio.newln( handle );
	fileio.newln( handle );
	fileio.newln( handle );

	fileio.puts( handle, "Real64 Powers of Two: " nl nl );
	for( mov( 0, ecx ); ecx < 1023; inc( ecx )) do

		fileio.pute64( handle, e64a, 15 );
		fileio.newln( handle );

		fld( e64a );
		fld( 2.0 );
		fmulp();
		fstp( e64a );

	endfor;
	fileio.newln( handle );
	fileio.newln( handle );
	fileio.newln( handle );



	fileio.puts( handle, "Real80 Powers of Two: " nl nl );
	for( mov( 0, ecx ); ecx < 16383; inc( ecx )) do

		fileio.pute80( handle, e80a, 18 );
		fileio.newln( handle );

		fld( e80a );
		fld( 2.0 );
		fmulp();
		fstp( e80a );

	endfor;
	fileio.newln( handle );
	fileio.newln( handle );
	fileio.newln( handle );


	fileio.close( handle );

end fpute_test;

													