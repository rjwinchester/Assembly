program fgeti_test;
#include( "stdlib.hhf" )

var
	Handle		:dword;
	inputF		:real80;
	
begin fgeti_test;


	// Testing fileio.geti32
	
	try
	
		fileio.open( "fgeti32.data", fileio.r );
		mov( eax, Handle );

		fileio.geti32( Handle );
		if( eax <> 1 ) then
		
			raise(1011);
		
		endif;	
		
		fileio.geti32( Handle );
		if( eax <> -2 ) then
		
			raise(1012);
		
		endif;	
		
		fileio.geti32( Handle );
		if( eax <> -2147483648 ) then
		
			raise(1013);
		
		endif;	
		
		fileio.geti32( Handle );
		if( eax <> 2147483647 ) then
		
			raise(1014);
		
		endif;


		
		try
		
			fileio.geti32( Handle );

		  unprotected
		  
		  	// We we got to this point, we failed to raise a conversion error.
			
		  	Raise( 1005 );
			
		  exception( ex.ConversionError )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( 1006 );
			
		endtry;
		fileio.readLn( Handle );	// Clean up after ourselves.
		
		
		try
		
			fileio.geti32( Handle );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( 1015 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( 1016 );
			
		endtry;
		fileio.readLn( Handle );
		
		
		// Better be at end of file.
		
		if( !fileio.eof( Handle )) then
		
			raise(1010);
			
		endif;
		stderr.put( "fgeti32 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"fgeti32 failed! eax=", (type uns32 eax), nl
			"Data read did not match data expected in file" nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;








	// Testing fileio.geti16
	
	try
	
		fileio.open( "fgeti16.data", fileio.r );
		mov( eax, Handle );

		fileio.geti16( Handle );
		if( ax <> 0 ) then
		
			raise(1021);
		
		endif;	
		
		fileio.geti16( Handle );
		if( ax <> 1 ) then
		
			raise(1022);
		
		endif;	
		
		fileio.geti16( Handle );
		if( ax <> -1 ) then
		
			raise(1023);
		
		endif;	
		
		fileio.geti16( Handle );
		if( ax <> -32768 ) then
		
			raise(1024);
		
		endif;	
		
		fileio.geti16( Handle );
		if( ax <> 32767 ) then
		
			raise(1025);
		
		endif;
		
		try
		
			fileio.geti16( Handle );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( 1026 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( 1027 );
			
		endtry;
		fileio.readLn( Handle );
		
		
		// Better be at end of file.
		
		if( !fileio.eof( Handle )) then
		
			raise(1020);
			
		endif;
		stderr.put( "fgeti16 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"fgeti16 failed! eax=", (type uns32 eax), nl
			"Data read did not match data expected in file" nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;





	// Testing fileio.geti8
	
	try
	
		fileio.open( "fgeti8.data", fileio.r );
		mov( eax, Handle );

		fileio.geti8( Handle );
		if( al <> 0 ) then
		
			raise(1031);
		
		endif;	
		
		fileio.geti8( Handle );
		if( al <> 1 ) then
		
			raise(1032);
		
		endif;	
		
		fileio.geti8( Handle );
		if( al <> -1 ) then
		
			raise(1033);
		
		endif;	
		
		fileio.geti8( Handle );
		if( (type int8 al) <> -128 ) then
		
			raise(1034);
		
		endif;
		
		fileio.geti8( Handle );
		if( al <> 127 ) then
		
			raise(1035);
		
		endif;
		
		try
		
			fileio.geti8( Handle );

		  unprotected
		  
		  	// We we got to this point, we failed to raise an overflow error.
			
		  	Raise( 1036 );
			
		  exception( ex.ValueOutOfRange )
		  
		  	// Okay, we succeeded if we got this exception.
			
		  anyexception
		  
		  	// Anything else? Pass it on.
			
		  	Raise( 1037 );
			
		endtry;
		fileio.readLn( Handle );
		
		
		// Better be at end of file.
		
		if( !fileio.eof( Handle )) then
		
			raise(1030);
			
		endif;
		stderr.put( "fgeti8 succeeded!" nl );
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"fgeti8 failed! eax=", (type uns32 eax), nl
			"Data read did not match data expected in file" nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;




			
end fgeti_test;

													