program fputr_test;
#include( "stdlib.hhf" )

static
	handle	:dword;
	r32		:real32 := 0.0;
	r64		:real64 := 0.0;
	r80		:real80 := 0.0;
	r32a	:real32 := 1.0;
	r64a	:real64 := 1.0;
	r80a	:real80 := 1.0;
	r32b	:real32 := 1.0e-6;
	r64b	:real64 := 1.0e-15;
	r80b	:real80 := 1.0e-18;
	r80c	:real80 := 1.0e-18;
	r80d	:real80 := 1.0e-18;
	r80pi	:real80;


	
begin fputr_test;


	fileio.openNew( "fputr.txt" );
	mov( eax, handle );

	fileio.puts( handle, "Outputting zeros:" nl nl );
	fileio.putr32( handle, r32, 6, 2, ' ' );
	fileio.newln( handle );

	fileio.putr64( handle, r64, 8, 4, ' ' );
	fileio.newln( handle );

	fileio.putr80( handle, r80, 10, 6, ' ' );
	fileio.newln( handle );
	fileio.newln( handle );
	fileio.newln( handle );

	fileio.puts( handle, "Real32 Powers of Ten: " nl nl );
	for( mov( -6, ecx ); (type int32 ecx) < 0; inc( ecx )) do

		fileio.putr32( handle, r32b, 11, 6, ' ' );
		fileio.newln( handle );

		fld( r32b );
		fld( 10.0 );
		fmulp();
		fstp( r32b );

	endfor;

	fld1();
	fstp( r32b );
	for( mov( 0, ecx ); ecx < 10; inc( ecx )) do

		fileio.putr32( handle, r32b, 14, 2, ' ' );
		fileio.newln( handle );

		fld( r32b );
		fld( 10.0 );
		fmulp();
		fstp( r32b );

	endfor;
	fileio.newln( handle );
	fileio.newln( handle );
	fileio.newln( handle );


	fileio.puts( handle, "Real64 Powers of Ten: " nl nl );
	for( mov( -15, ecx ); (type int32 ecx) < 0; inc( ecx )) do

		fileio.putr64( handle, r64b, 18, 15, ' ' );
		fileio.newln( handle );

		fld( r64b );
		fld( 10.0 );
		fmulp();
		fstp( r64b );

	endfor;

	fld1();
	fstp( r64b );
	for( mov( 0, ecx ); ecx < 15; inc( ecx )) do

		fileio.putr64( handle, r64b, 32, 15, ' ' );
		fileio.newln( handle );

		fld( r64b );
		fld( 10.0 );
		fmulp();
		fstp( r64b );

	endfor;
	fileio.newln( handle );
	fileio.newln( handle );
	fileio.newln( handle );


	fileio.puts( handle, "Real80 Powers of Ten: " nl nl );
	for( mov( -18, ecx ); (type int32 ecx) < 0; inc( ecx )) do

		fileio.putr80( handle, r80b, 21, 14, ' ' );
		fileio.newln( handle );

		fld( r80b );
		fld( 10.0 );
		fmulp();
		fstp( r80b );

	endfor;

	fld1();
	fstp( r80b );
	for( mov( 0, ecx ); ecx < 18; inc( ecx )) do

		fileio.putr80( handle, r80b, 21, 1, ' ' );
		fileio.newln( handle );

		fld( r80b );
		fld( 10.0 );
		fmulp();
		fstp( r80b );

	endfor;
	fileio.newln( handle );
	fileio.newln( handle );
	fileio.newln( handle );



	fileio.puts( handle, "Real80 Digit Sums: " nl nl );
	fld( r80c );
	fstp( r80b );
	for( mov( 0, ecx ); ecx < 18; inc( ecx )) do

		fileio.putr80( handle, r80b, 21, 14, ' ' );
		fileio.newln( handle );

		fld( r80b );
		fld( 10.0 );
		fmulp();

		fld( r80c );
		fld( r80d );
		faddp();
		fld( st0 );
		fstp( r80d );
		faddp();
		fstp( r80b );

	endfor;
	fileio.newln( handle );
	fileio.newln( handle );
	fileio.newln( handle );



	// Output values in a field width that is too small so
	// we can test the "####" output:

	fileio.putr32( handle, 123456789.0, 10, 4, ' ' );
	fileio.newln( handle );
	fileio.putr64( handle, 123456789.0, 10, 4, ' ' );
	fileio.newln( handle );
	fileio.putr80( handle, 123456789.0, 10, 4, ' ' );
	fileio.newln( handle );

	fileio.close( handle );

end fputr_test;

													