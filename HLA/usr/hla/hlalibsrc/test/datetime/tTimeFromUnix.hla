program fromUnix_Test;
#include( "stdlib.hhf" )

static
	unixTime	:qword;
	tm			:time.timerec;
	_tm			:time.timerec;
	dt			:date.daterec;
	_dt			:date.daterec;	
	
begin fromUnix_Test;


	mov( 0, (type dword unixTime[0]) );
	mov( 0, (type dword unixTime[4]) );
	date.pack( 1, 1, 1970, dt );
	time.pack( 0, 0, 0, tm );
			 
	while( (type dword unixTime) < $8000_0000 ) do
	
		time.fromUnixTime( unixTime, _tm, _dt );
		mov( _tm, ebx );
		mov( _dt, ecx );
		if( ebx <> (type dword tm) || ecx <> (type dword dt) ) then
		
			stderr.put
			( 
				nl nl 
				"***************************************************" nl
				"time.fromUnix failed!", nl,
				"ebx=", ebx, " tm=", (type dword tm), nl
				"ecx=", ecx, " dt.date=", (type dword dt), nl
				"fromUnixTime = ", (type dword unixTime), nl,
				"date="
			);
			date.a_toString( dt );
			stderr.puts( eax );
			str.free( eax );
			stderr.put( " <> " );
			date.a_toString( _dt );
			stderr.puts( eax );
			str.free( eax );
			stderr.put
			(
				nl
				"time="
			);
			time.a_toString( tm );
			stderr.puts( eax );
			str.free( eax );
			stderr.put( " <> " );
			time.a_toString( tm );
			stderr.puts( eax );
			str.free( eax );			
			stderr.put
			(	nl
				"***************************************************" nl
				nl 
			);
			stdout.put( "Press Enter to Continue: " );
			stdin.readLn();
			os.exitProcess(1);
			
		endif;
		if( (type dword unixTime) < $80_0000 ) then
		
			inc( (type dword unixTime ) );
			inc( tm.secs );
			if( tm.secs >= 60 )  then
			
				mov( 0, tm.secs );
				inc( tm.mins );
				if( tm.mins >= 60 ) then
				
					mov( 0, tm.mins );
					inc( tm.hours );
					if( tm.hours >= 24 ) then
					
						mov( 0, tm.hours );
						date.addDays( 1, dt );
						
					endif;
					
				endif;
				
			endif;
			
		else
		
			add( 256, (type dword unixTime));
			add( 16, tm.secs );
			if( tm.secs >= 60 )  then
			
				sub( 60, tm.secs );
				inc( tm.mins );
				if( tm.mins >= 60 ) then
				
					mov( 0, tm.mins );
					inc( tm.hours );
					if( tm.hours >= 24 ) then
					
						mov( 0, tm.hours );
						date.addDays( 1, dt );
						
					endif;
					
				endif;
				
			endif;
			add( 4, tm.mins );
			if( tm.mins >= 60 ) then
			
				sub( 60, tm.mins );
				inc( tm.hours );
				if( tm.hours >= 24 ) then
				
					mov( 0, tm.hours );
					date.addDays( 1, dt );
					
				endif;
				
			endif;
				 			
		endif;
						
	endwhile;
	stderr.put( "time.fromUnix succeeded!" nl );
	os.exitProcess(0);
		
end fromUnix_Test;

													