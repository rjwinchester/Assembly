program DatePlusYears_test;
#include( "stdlib.hhf" )

static
	baseDate	:date.daterec;
	incDate		:date.daterec;
	addDate		:date.daterec;
	
	altDate		:date.daterec;
	endDate		:date.daterec;
	
	years		:dword;
	days		:dword;
	
	
begin DatePlusYears_test;

	 
	date.setFormat( date.mmddyyyy );
	
	date.pack( 12, 1, date.minYear, baseDate );
	mov( (type dword baseDate), eax );
	mov( eax, (type dword incDate));
	mov( eax, (type dword addDate));
	mov( eax, (type dword altDate));
	
	date.pack( 12, 1, date.maxYear-2, endDate );
	
	mov( 0, years );
	while( mov( endDate, eax ) >= (type dword altDate) ) do
	
		inc( years );
		mov( (type dword baseDate), eax );
		mov( eax, addDate );
		date.addYears( years, addDate ); 
		date.addYears( 1, incDate );
		inc( altDate.year );
		
		for( mov( 0, days); days < 366; inc( days )) do
		
			date.addDays( 1, addDate );
			date.addDays( 1, incDate );
			date.addDays( 1, altDate );
			mov( addDate, eax );
			mov( incDate, ebx );
			mov( altDate, ecx );
			if( eax <> ebx || eax <> ecx ) then
			
				stderr.put
				( 
					nl nl 
					"***************************************************" nl
					"date.dateAddYears failed!", nl,
					"incDate= '"
				);
				date.a_toString( incDate );
				stderr.put
				(
					(type string eax), "'" nl
					"addDate=  '"
				);
				str.free( eax );
				date.a_toString( addDate );
				stderr.put
				(
					(type string eax), "'" nl
				);
				str.free( eax );
				date.a_toString( altDate );
				stderr.put
				(
					(type string eax), "'" nl
				
					"***************************************************" nl
					nl 
				);
				str.free( eax );
				stdout.put( "Press Enter to Continue: " );
				stdin.readLn();
				os.exitProcess(1);
				
			endif;
		
		endfor;
		date.subDays( 366, addDate );
		date.subDays( 366, incDate );
		date.subDays( 366, altDate );
		
	endwhile;
	stderr.put( "date.dateAddYears succeeded!" nl );
	os.exitProcess(0);
		
end DatePlusYears_test;

													