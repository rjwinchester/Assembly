program valid_test;
#include( "stdlib.hhf" )
#include( "dtClass.hhf" )

static
	baseDate	:date.daterec;
	endDate		:date.daterec;
	
	dc			:dateClass;
	vdc			:virtualDateClass;	
	
begin valid_test;

	 
	date.setFormat( date.mmddyyyy );
	dc.create();
	vdc.create();

	date.pack( 1, 1, date.minYear, baseDate );
	date.pack( 12, 31, date.maxYear-1, endDate );
	
	while( mov( baseDate, eax ) <= (type dword endDate) ) do
	
		movzx( baseDate.month, ebx );
		if( ebx in 1..12 ) then
		
			movzx( baseDate.day, ecx );
			xor( eax, eax );
			if( ebx == 2 ) then
			
				date.isLeapYear( baseDate.year );
				
			endif;
			add( date.DaysInMonth[ebx*4], eax );
			if( ecx > 0 && ecx <= eax ) then
			
				try
				
					date.validate( baseDate );
					
				  exception( ex.InvalidDate )
			
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"date.isvalidate failed!", nl,
						"Date= '",
						(type uns8 baseDate.month),
						"/",
						(type uns8 baseDate.day),
						"/",
						(type uns16 baseDate.year ),
						nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);
					
				  anyexception
				  
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"date.validate failed! Bad Exception!", nl,
						"Exception= '", eax, nl,
						nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);

				endtry;

				try
				
					dc.validate();
					
				  exception( ex.InvalidDate )
			
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"dc.isvalidate failed! (1)", nl,
						"Date= '", dc, nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);
					
				  anyexception
				  
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"dc.validate failed! Bad Exception! (1)", nl,
						"Exception= '", eax, nl,
						nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);

				endtry;

				try
				
					vdc.validate();
					
				  exception( ex.InvalidDate )
			
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"vdc.isvalidate failed! (1)", nl,
						"Date= '", vdc, nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);
					
				  anyexception
				  
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"vdc.validate failed! Bad Exception! (1)", nl,
						"Exception= '", eax, nl,
						nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);

				endtry;

			else
			
				try
				
					date.validate( baseDate );
			
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"date.validate should have raised an exception! (2)", nl,
						"Date= '",
						(type uns8 baseDate.month),
						"/",
						(type uns8 baseDate.day),
						"/",
						(type uns16 baseDate.year ),
						nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);
					
				  exception( ex.InvalidDate );
				  
				  	// This is the condition we expect.
					
				  anyexception
				  
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"date.validate failed! Bad Exception! (2)", nl,
						"Exception= '", eax, nl,
						nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);

					
				endtry;
			
				try
				
					dc.validate();
			
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"vdc.validate should have raised an exception! (2)", nl,
						"Date= '", dc, nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);
					
				  exception( ex.InvalidDate );
				  
				  	// This is the condition we expect.
					
				  anyexception
				  
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"dc.validate failed! Bad Exception! (2)", nl,
						"Exception= '", eax, nl,
						nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);

					
				endtry;
			
				try
				
					vdc.validate();
			
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"vdc.validate should have raised an exception! (2)", nl,
						"Date= '", vdc, nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);
					
				  exception( ex.InvalidDate );
				  
				  	// This is the condition we expect.
					
				  anyexception
				  
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"vdc.validate failed! Bad Exception! (2)", nl,
						"Exception= '", eax, nl,
						nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);

					
				endtry;

			endif;
			
		else
		
			try
				
				date.validate( baseDate );
				stderr.put
				( 
					nl nl 
					"***************************************************" nl
					"date.validate should have failed! (3)", nl,
					"Date= '",
					(type uns8 baseDate.month),
					"/",
					(type uns8 baseDate.day),
					"/",
					(type uns16 baseDate.year ),
					nl
				);
				stdout.put( "Press Enter to Continue: " );
				stdin.readLn();
				os.exitProcess(1);
				
					
			  exception( ex.InvalidDate );
			  
			  	// This is the condition we expect.
				
			  anyexception
			  
				stderr.put
				( 
					nl nl 
					"***************************************************" nl
					"date.validate failed! Bad Exception! (3)", nl,
					"Exception= '", eax, nl,
					nl
				);
				stdout.put( "Press Enter to Continue: " );
				stdin.readLn();
				os.exitProcess(1);

				
			endtry;
		
			try
				
				dc.validate( );
				stderr.put
				( 
					nl nl 
					"***************************************************" nl
					"dc.validate should have failed! (3)", nl,
					"Date= '", dc, nl
				);
				stdout.put( "Press Enter to Continue: " );
				stdin.readLn();
				os.exitProcess(1);
				
					
			  exception( ex.InvalidDate );
			  
			  	// This is the condition we expect.
				
			  anyexception
			  
				stderr.put
				( 
					nl nl 
					"***************************************************" nl
					"dc.validate failed! Bad Exception! (3)", nl,
					"Exception= '", eax, nl,
					nl
				);
				stdout.put( "Press Enter to Continue: " );
				stdin.readLn();
				os.exitProcess(1);

				
			endtry;
		
			try
				
				vdc.validate( );
				stderr.put
				( 
					nl nl 
					"***************************************************" nl
					"vdc.validate should have failed! (3)", nl,
					"Date= '", vdc, nl
				);
				stdout.put( "Press Enter to Continue: " );
				stdin.readLn();
				os.exitProcess(1);
				
					
			  exception( ex.InvalidDate );
			  
			  	// This is the condition we expect.
				
			  anyexception
			  
				stderr.put
				( 
					nl nl 
					"***************************************************" nl
					"vdc.validate failed! Bad Exception! (3)", nl,
					"Exception= '", eax, nl,
					nl
				);
				stdout.put( "Press Enter to Continue: " );
				stdin.readLn();
				os.exitProcess(1);

				
			endtry;

		endif;
		add( 1, baseDate.day );
		adc( 0, baseDate.month );
		adc( 0, baseDate.year );
		
		mov( baseDate, eax );
		mov( eax, dc.theDate );
		mov( eax, vdc.theDate );
		
	endwhile;
	stderr.put( "date.validate succeeded!" nl );
	os.exitProcess(0);
		
end valid_test;

													