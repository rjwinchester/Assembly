program isValid_test;
#include( "stdlib.hhf" )
#include( "dtClass.hhf" )

static
	baseDate	:date.daterec;
	endDate		:date.daterec;
	
	dc			:dateClass;
	vdc			:virtualDateClass;	
	
begin isValid_test;

	 
	date.setFormat( date.mmddyyyy );
	dc.create();
	vdc.create();

	date.pack( 1, 1, date.minYear, baseDate );
	date.pack( 12, 31, date.maxYear-1, endDate );
	
	while( mov( baseDate, eax ) <= (type dword endDate) ) do
	
		movzx( baseDate.month, ebx );
		if( ebx in 1..12 ) then
		
			movzx( baseDate.day, ecx );
			xor( eax, eax );
			if( ebx == 2 ) then
			
				date.isLeapYear( baseDate.year );
				
			endif;
			add( date.DaysInMonth[ebx*4], eax );
			if( ecx > 0 && ecx <= eax ) then
			
				if( !date.isValid( baseDate )) then
			
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"dateClass.isValid failed! (1)", nl,
						"Date= '",
						(type uns8 baseDate.month),
						"/",
						(type uns8 baseDate.day),
						"/",
						(type uns16 baseDate.year ),
						nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);
					
				endif;

				if( !dc.isValid()) then
			
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"dc.isValid failed! (2)", nl,
						"Date= '", 
						dc,
						nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);
					
				endif;

				if( !vdc.isValid()) then
			
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"vdc.isValid failed! (3)", nl,
						"Date= '", 
						vdc,
						nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);
					
				endif;

			else
			
				if( date.isValid( baseDate )) then
			
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"dateClass.isValid should have failed! (1)", nl,
						"Date= '",
						(type uns8 baseDate.month),
						"/",
						(type uns8 baseDate.day),
						"/",
						(type uns16 baseDate.year ),
						nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);
					
				endif;

				if( dc.isValid()) then
			
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"dc.isValid should have failed! (2)", nl,
						"Date= '", dc, nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);
					
				endif;

				if( vdc.isValid()) then
			
					stderr.put
					( 
						nl nl 
						"***************************************************" nl
						"vdc.isValid should have failed! (3)", nl,
						"Date= '", vdc, nl
					);
					stdout.put( "Press Enter to Continue: " );
					stdin.readLn();
					os.exitProcess(1);
					
				endif;

			endif;
			
		else
		
			if( date.isValid( baseDate )) then
		
				stderr.put
				( 
					nl nl 
					"***************************************************" nl
					"dateClass.isValid should have failed! (4)", nl,
					"Date= '",
					(type uns8 baseDate.month),
					"/",
					(type uns8 baseDate.day),
					"/",
					(type uns16 baseDate.year ),
					nl
				);
				stdout.put( "Press Enter to Continue: " );
				stdin.readLn();
				os.exitProcess(1);
				
			endif;

			if( dc.isValid()) then
		
				stderr.put
				( 
					nl nl 
					"***************************************************" nl
					"dc.isValid should have failed! (5)", nl,
					"Date= '", dc, nl
				);
				stdout.put( "Press Enter to Continue: " );
				stdin.readLn();
				os.exitProcess(1);
				
			endif;

			if( vdc.isValid()) then
		
				stderr.put
				( 
					nl nl 
					"***************************************************" nl
					"vdc.isValid should have failed! (6)", nl,
					"Date= '", vdc, nl
				);
				stdout.put( "Press Enter to Continue: " );
				stdin.readLn();
				os.exitProcess(1);
				
			endif;

		endif;
		add( 1, baseDate.day );
		adc( 0, baseDate.month );
		adc( 0, baseDate.year );
		
		add( 1, dc.theDate.day );
		adc( 0, dc.theDate.month );
		adc( 0, dc.theDate.year );
		
		add( 1, vdc.theDate.day );
		adc( 0, vdc.theDate.month );
		adc( 0, vdc.theDate.year );
		
	endwhile;
	stderr.put( "dateClass.isValid succeeded!" nl );
	os.exitProcess(0);
		
end isValid_test;

													