program DateMinusDays_test;
#include( "stdlib.hhf" )
#include( "dtClass.hhf" )

static
	baseDate	:date.daterec;
	decDate		:date.daterec;
	subDate		:date.daterec;
	
	tmp			:date.daterec;
	
	baseJul		:dword;
	decJul		:dword;
	finalJul	:dword;
	
	days		:dword;
	
	dc			:dateClass;
	vdc			:virtualDateClass;
	
	
begin DateMinusDays_test;

	date.setFormat( date.mmddyyyy );

	dc.create();
	vdc.create();
	 

	date.toJulian( 12, 31, date.maxYear-1 );
	mov( eax, baseJul );
	mov( eax, decJul );
	
	date.toJulian( 1, 2, date.minYear );
	mov( eax, finalJul );
	
	date.pack( 12, 31, date.maxYear-1, baseDate );
	mov( (type dword baseDate), eax );
	mov( eax, (type dword decDate));
	mov( eax, (type dword subDate));
	mov( eax, dc.theDate );
	mov( eax, vdc.theDate );
	
	mov( 0, days );
	while( mov( decJul, eax ) >= finalJul ) do
	
		inc( days );
		dec( decJul );
		mov( (type dword baseDate), eax );
		mov( eax, subDate );
		date.subDays( days, subDate ); 
		date.subDays( 1, decDate );
		dc.subDays( 1 );
		vdc.subDays( 1 );
		
		dc.toJulian();
		mov( eax, ecx );
		
		vdc.toJulian();
		mov( eax, edx );
		
		date.toJulian( decDate );
		mov( eax, ebx );
		date.toJulian( subDate );
		if
		( 
				eax <> ebx
			||	eax <> ecx
			||	eax <> edx 
			||	eax <> decJul 
		) then
		
			stderr.put
			( 
				nl nl 
				"***************************************************" nl
				"dateClass.subDays failed!", nl,
				"decDate= '"
			);
			date.a_toString( decDate );
			stderr.put
			(
				(type string eax), "'" nl
				"decJul=  '"
			);
			str.free( eax );
			date.fromJulian( decJul, tmp );
			date.a_toString( tmp );
			stderr.put
			(
				(type string eax), "'" nl
				" dc = '", dc, "'" nl
				" vdc= '", vdc, "'" nl
			
				"***************************************************" nl
				nl 
			);
			str.free( eax );
			stdout.put( "Press Enter to Continue: " );
			stdin.readLn();
			stdout.put( "Press Enter to Continue: " );
			stdin.readLn();
			os.exitProcess(1);
			
		endif;
		
	endwhile;
	stderr.put( "dateClass.subDays succeeded!" nl );
	os.exitProcess(0);
		
end DateMinusDays_test;

													