program bagets_test;
#include( "stdlib.hhf" )

var
	b			:blob.blob;
	inputLine	:string;
	
begin bagets_test;

	try
	
		blob.a_load( "bagets.data" );
		mov( eax, b );
		
		blob.a_gets( b );
		mov( eax, inputLine );
		if( str.ne( inputLine, "This is a test of bagets" )) then
		
			raise( 0 );
			
		endif;
		str.free( inputLine );
		
		blob.a_gets( b );
		mov( eax, inputLine );
		if( str.ne( inputLine, "This is a second line" )) then
		
			raise( 0 );
			
		endif;
		str.free( inputLine );
		blob.eof(b);
		if( !blob.eof( b )) then
		
			raise(0);
			
		endif;
		stderr.put( "bagets succeeded!" nl );
		os.exitProcess(0);
		
	  anyexception
	  
		stderr.put
		( 
			nl nl 
			"***************************************************" nl
			"bagets failed!" nl
			"Data read did not match data expected in file" nl
			"Exception = ", eax, nl
			"***************************************************" nl
			nl 
		);
		stdout.put( "Press Enter to Continue: " );
		stdin.readLn();
		os.exitProcess(1);
		
	endtry;
	stderr.put
	( 
		nl nl 
		"***************************************************" nl
		"bagets failed!" nl
		"Unknown problem with fagets test" nl
		nl 
	);
	stdout.put( "Press Enter to Continue: " );
	stdin.readLn();
	os.exitProcess(1);
			
end bagets_test;

													